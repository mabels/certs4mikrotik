apiVersion: batch/v1
kind: CronJob
metadata:
  annotations:
    kubectl.kubernetes.io/last-applied-configuration: |
      {"apiVersion":"batch/v1","kind":"CronJob","metadata":{"annotations":{},"name":"mikrotik-cert-upload","namespace":"default"},"spec":{"failedJobsHistoryLimit":1,"jobTemplate":{"spec":{"template":{"spec":{"containers":[{"command":["/bin/bash","-c","set -xe\n\n# Install Python dependencies\npip install librouteros paramiko scp kubernetes\n\n# Run the complete upload script\npython3 /scripts/upload-router-complete.py \\\n  --config /config/routers.json \\\n  --namespace default \\\n  --issuer letsencrypt-prod \\\n  --domain-suffix .adviser.com \\\n  --verbose\n"],"image":"python:3.11-slim","name":"cert-uploader","volumeMounts":[{"mountPath":"/scripts","name":"upload-script","readOnly":true},{"mountPath":"/config","name":"router-config","readOnly":true}]}],"restartPolicy":"OnFailure","serviceAccountName":"mikrotik-cert-uploader","volumes":[{"configMap":{"name":"upload-router-complete-script"},"name":"upload-script"},{"configMap":{"name":"mikrotik-routers-config"},"name":"router-config"}]}}}},"schedule":"0 2 * * 0,3","successfulJobsHistoryLimit":3}}
  creationTimestamp: "2025-09-14T14:28:00Z"
  generation: 13
  name: mikrotik-cert-upload
  namespace: default
  resourceVersion: "3472802"
  uid: 5cb0383a-83ec-4d40-9a38-3b62eb5a7762
spec:
  concurrencyPolicy: Allow
  failedJobsHistoryLimit: 1
  jobTemplate:
    metadata:
      creationTimestamp: null
    spec:
      template:
        metadata:
          creationTimestamp: null
        spec:
          containers:
          - command:
            - /bin/bash
            - -c
            - |
              set -xe

              # Install Python dependencies
              pip install librouteros paramiko scp kubernetes

              # Run the complete upload script
              python3 /scripts/upload-router-complete.py \
                --config /config/routers.json \
                --namespace default \
                --issuer letsencrypt-prod \
                --domain-suffix .adviser.com \
                --verbose
            image: python:3.11-slim
            imagePullPolicy: IfNotPresent
            name: cert-uploader
            resources: {}
            terminationMessagePath: /dev/termination-log
            terminationMessagePolicy: File
            volumeMounts:
            - mountPath: /scripts
              name: upload-script
              readOnly: true
            - mountPath: /config
              name: router-config
              readOnly: true
          dnsPolicy: ClusterFirst
          restartPolicy: OnFailure
          schedulerName: default-scheduler
          securityContext: {}
          serviceAccount: mikrotik-cert-uploader
          serviceAccountName: mikrotik-cert-uploader
          terminationGracePeriodSeconds: 30
          volumes:
          - configMap:
              defaultMode: 420
              name: upload-router-complete-script
            name: upload-script
          - configMap:
              defaultMode: 420
              name: mikrotik-routers-config
            name: router-config
  schedule: 0 2 * * 0,3
  successfulJobsHistoryLimit: 3
  suspend: false
status:
  lastScheduleTime: "2025-10-19T02:00:00Z"
  lastSuccessfulTime: "2025-10-20T05:34:57Z"
